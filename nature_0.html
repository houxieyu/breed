<!DOCTYPE html>
<meta charset="utf-8">
<style>
    .chart rect {
        fill: steelblue;
    }

    .chart text {
        fill: white;
        font: 10px sans-serif;
        text-anchor: end;
    }
    html,body{
        height:100%;
    }
    line{
        stroke:rgb(99,99,99);stroke-width:2
    }
</style>
<html>
    <head></head>
    <body>
<svg class="chart"></svg>
</body>
</html>
<script src="//d3js.org/d3.v3.min.js"></script>
<script src="breed.js"></script>
<script>
    var allData = initDatas();
    var breeddata = allData.nodeDatas;
    var linedata = allData.lineDatas;
    var width = 420,
        ptwidth = 30,
        padframe = 50,
        padinner = 50,
        padvertical = 100;

    var x = d3.scale.linear()
        .range([0, width]);

    var chart = d3.select(".chart")
                    .attr("width","100%") ;
                    // .attr("height","auto");;

    // d3.tsv("data.tsv", type, function (error, data) {
        // x.domain([0, d3.max(data, function (d) { return d.value; })]);

        // chart.attr("height", ptwidth * breeddata.length);

        var bar = chart.selectAll("g")
            .data(breeddata)
            .enter().append("g")
            .attr("transform", function (d, i) { return "translate(0," + (padframe+i * (ptwidth+padvertical)) + ")"; });

        bar.each(function(ele,i) {
            d3.select(this).selectAll("circle")
                .data(breeddata[i])
                .enter().append("circle")
                .attr("r", ptwidth/2 )
                .attr("transform", function (d, j) {
                     return "translate(" + (padframe+j * (ptwidth+padinner)) + ",0)"; 
                });
        });
        
        //绘制关系
        chart.selectAll("line")
            .data(linedata)
            .enter().append("line")
            .attr("x1",function(d){
                console.log(d)
                return padframe+(d.sNode.id-1)*(ptwidth+padinner);
            })
            .attr("y1",function(d){
                return padframe+d.sNode.layno*(ptwidth+padvertical);
            })
            .attr("x2",function(d){
                return padframe+(d.eNode.id-1)*(ptwidth+padinner);
            })
            .attr("y2",function(d){
                return padframe+d.eNode.layno*(ptwidth+padvertical);
            });
        chart.attr("height", (ptwidth+padvertical) * breeddata.length);
    // });

    function type(d) {
        d.value = +d.value; // coerce to number
        return d;
    }

</script>